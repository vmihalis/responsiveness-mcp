---
phase: 22-report-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/output/reporter.ts
  - src/output/types.ts
  - src/output/__tests__/reporter.test.ts
autonomous: true

must_haves:
  truths:
    - "Thumbnail cards in report show no fold line overlay"
    - "Lightbox view shows no fold line overlay"
    - "Report generates successfully without fold data"
    - "All tests pass after fold line removal"
  artifacts:
    - path: "src/output/reporter.ts"
      provides: "Report generation without fold line code"
      removes:
        - "THUMBNAIL_ASPECT_RATIO constant"
        - "getPngDimensions function"
        - "calculateFoldPositions function"
        - ".thumbnail-link::after CSS"
        - ".lightbox-content CSS"
    - path: "src/output/types.ts"
      provides: "Simplified ScreenshotForReport interface"
      removes:
        - "screenshotWidth field"
        - "screenshotHeight field"
        - "foldPositionLightbox field"
        - "foldPositionThumbnail field"
    - path: "src/output/__tests__/reporter.test.ts"
      provides: "Updated tests without fold line assertions"
      removes:
        - "getPngDimensions describe block"
        - "calculateFoldPositions describe block"
        - "fold line styles and rendering describe block"
  key_links:
    - from: "prepareScreenshotsForReport"
      to: "ScreenshotForReport"
      via: "object creation"
      pattern: "screenshots\\.push\\(\\{[^}]+\\}\\)"
    - from: "renderThumbnailCard"
      to: "HTML output"
      via: "template literal"
      pattern: "class=\"thumbnail-link\""
    - from: "renderLightbox"
      to: "HTML output"
      via: "template literal"
      pattern: "<img src="
---

<objective>
Remove fold line indicator from HTML report generation.

Purpose: The fold line was added in v2.1 to show the viewport boundary on full-page screenshots. With v3.0's viewport-only default, the entire screenshot IS "above the fold" - no indicator is needed. This cleanup removes ~180 lines of dead code.

Output: Simplified reporter.ts, types.ts, and updated tests with fold line code completely removed.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-report-cleanup/22-RESEARCH.md

# Source files to modify
@src/output/reporter.ts
@src/output/types.ts
@src/output/__tests__/reporter.test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove fold line code from reporter.ts and types.ts</name>
  <files>
    src/output/reporter.ts
    src/output/types.ts
  </files>
  <action>
Remove all fold-related code from reporter.ts and types.ts:

**In src/output/reporter.ts:**

1. Remove `THUMBNAIL_ASPECT_RATIO` constant (line 8)

2. Remove `getPngDimensions()` function (lines 19-33) - only used for fold calculation

3. Remove `calculateFoldPositions()` function (lines 43-75)

4. Remove fold line CSS from CSS_STYLES constant:
   - Remove `.thumbnail-link::after` rule (lines 229-239)
   - Remove `.lightbox-content` rule (lines 318-321)
   - Remove `.lightbox-content::after` rule (lines 323-333)

5. Simplify `renderThumbnailCard()` (around line 656):
   - Remove foldStyle variable and calculation (lines 663-666)
   - Remove `${foldStyle}` from the template literal
   - The `<a>` should be: `<a href="#${lightboxId}" class="thumbnail-link">`

6. Simplify `renderLightbox()` (around line 708):
   - Remove foldStyle variable (line 715)
   - Remove the `<div class="lightbox-content">` wrapper
   - Image should be direct child of lightbox: `<img src="${screenshot.dataUri}" alt="...">` (not wrapped in lightbox-content div)

7. Simplify `prepareScreenshotsForReport()` (around line 798):
   - Remove getPngDimensions call (line 814)
   - Remove calculateFoldPositions call (lines 817-821)
   - Remove screenshotWidth, screenshotHeight, foldPositionLightbox, foldPositionThumbnail from the pushed object (lines 829-832)
   - The pushed object should only have: deviceName, category, width, height, dataUri

**In src/output/types.ts:**

8. Remove fold-related fields from ScreenshotForReport interface (lines 74-81):
   - Remove `screenshotWidth: number;`
   - Remove `screenshotHeight: number;`
   - Remove `foldPositionLightbox: number;`
   - Remove `foldPositionThumbnail: number | null;`
   - Also remove the associated doc comments

The simplified ScreenshotForReport should be:
```typescript
export interface ScreenshotForReport {
  /** Device display name */
  deviceName: string;
  /** Device category for grouping */
  category: DeviceCategory;
  /** Viewport width */
  width: number;
  /** Viewport height */
  height: number;
  /** Base64 data URI (data:image/png;base64,...) */
  dataUri: string;
}
```

Note: Keep the comment on `height` as "Viewport height" (remove the "(the fold position)" part since fold is no longer relevant).
  </action>
  <verify>
Run TypeScript compiler to verify no type errors:
```bash
cd /home/memehalis/responsiveness-mcp && npx tsc --noEmit
```
Should complete with no errors.
  </verify>
  <done>
- THUMBNAIL_ASPECT_RATIO, getPngDimensions, calculateFoldPositions functions removed
- Fold line CSS rules removed from CSS_STYLES
- renderThumbnailCard no longer outputs fold style attribute
- renderLightbox no longer outputs lightbox-content wrapper div
- prepareScreenshotsForReport no longer calculates fold positions
- ScreenshotForReport interface has only 5 fields: deviceName, category, width, height, dataUri
- TypeScript compiles without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Update tests to remove fold line assertions</name>
  <files>
    src/output/__tests__/reporter.test.ts
  </files>
  <action>
Update reporter.test.ts to remove fold-related tests and update fixtures:

**1. Remove imports (line 13-14):**
   - Remove `getPngDimensions` from the import
   - Remove `calculateFoldPositions` from the import

**2. Remove test describe blocks:**
   - Remove entire `describe('getPngDimensions')` block (lines 270-306)
   - Remove entire `describe('calculateFoldPositions')` block (lines 308-371)
   - Remove entire `describe('fold line styles and rendering')` block (lines 589-669)

**3. Update mock screenshot fixtures - remove fold fields:**

Update `mockScreenshot` (around line 378):
```typescript
const mockScreenshot: ScreenshotForReport = {
  deviceName: 'iPhone 15 Pro',
  category: 'phones',
  width: 393,
  height: 852,
  dataUri: 'data:image/png;base64,iVBORw0KGgo=',
};
```

**4. Update all other ScreenshotForReport objects in tests:**

Search for objects with `screenshotWidth`, `screenshotHeight`, `foldPositionLightbox`, `foldPositionThumbnail` and remove those fields:

- In `groupByCategory` tests (around lines 213-249)
- In `buildReportHtml` tests (around lines 547-568)
- In `prepareScreenshotsForReport` tests (around lines 705-829)
- In `generateReport` tests (around lines 893-940)
- In `renderThumbnailCard with preview` tests (around lines 1018-1028)
- In `buildReportHtml with modal` tests (around lines 1095-1131)

**5. Update prepareScreenshotsForReport test assertions:**

In the `prepareScreenshotsForReport` describe block:
- Remove assertions for `screenshotWidth`, `screenshotHeight`, `foldPositionLightbox`, `foldPositionThumbnail`
- Keep assertions for `deviceName`, `category`, `width`, `height`, `dataUri`

For example, the test "converts ExecutionResult[] to ScreenshotForReport[]" should become:
```typescript
expect(screenshots[0]?.deviceName).toBe('iPhone 15 Pro');
expect(screenshots[0]?.category).toBe('phones');
expect(screenshots[0]?.width).toBe(393);
expect(screenshots[0]?.height).toBe(852);
expect(screenshots[0]?.dataUri).toMatch(/^data:image\/png;base64,/);
// Remove the fold position assertions
```

**6. Keep the `createTestPngBuffer` helper function** - it's still used by other tests that call prepareScreenshotsForReport (which still needs valid PNG buffers for the bufferToDataUri call, even though we no longer extract dimensions).
  </action>
  <verify>
Run the test suite:
```bash
cd /home/memehalis/responsiveness-mcp && npm test
```
All tests should pass. Test count should decrease by ~19 tests.
  </verify>
  <done>
- getPngDimensions and calculateFoldPositions removed from imports
- Three fold-related describe blocks removed (~19 tests)
- All mock ScreenshotForReport objects updated to have only 5 fields
- prepareScreenshotsForReport test assertions updated
- All tests pass
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. **TypeScript compiles:** `npx tsc --noEmit` exits 0
2. **All tests pass:** `npm test` exits 0
3. **No fold references remain:**
   ```bash
   grep -r "fold" src/output/ --include="*.ts" | grep -v node_modules
   ```
   Should return no matches.
4. **CSS has no fold-position variable:**
   ```bash
   grep "fold-position" src/output/reporter.ts
   ```
   Should return no matches.
5. **ScreenshotForReport is simplified:** Verify types.ts has only 5 fields in interface.
</verification>

<success_criteria>
1. `npx tsc --noEmit` exits 0 (no type errors)
2. `npm test` exits 0 (all tests pass)
3. No "fold" string appears in src/output/*.ts files
4. ScreenshotForReport interface has exactly 5 fields
5. CSS_STYLES constant contains no ::after pseudo-elements for fold lines
6. renderLightbox outputs `<img>` directly without wrapper div
</success_criteria>

<output>
After completion, create `.planning/phases/22-report-cleanup/22-01-SUMMARY.md` following the summary template.
</output>

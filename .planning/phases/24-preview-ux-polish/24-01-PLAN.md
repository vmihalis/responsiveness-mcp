---
phase: 24-preview-ux-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/output/reporter.ts
autonomous: true

must_haves:
  truths:
    - "Preview button is visible on every card without hovering"
    - "Preview button is large and bold enough to be obviously clickable"
    - "Modal opens centered on screen (no left-drift)"
    - "Modal takes 80-90% of viewport"
    - "Device iframe is centered within the modal"
    - "Device name and dimensions are displayed in modal header"
  artifacts:
    - path: "src/output/reporter.ts"
      provides: "Updated CSS_STYLES with button prominence and modal centering"
      contains: "position: fixed"
    - path: "src/output/reporter.ts"
      provides: "Updated modal template with device info header"
      contains: "modal-device-name"
    - path: "src/output/reporter.ts"
      provides: "Updated openPreview function with deviceName parameter"
      contains: "openPreview(url, width, height, deviceName)"
  key_links:
    - from: "renderThumbnailCard"
      to: "openPreview"
      via: "onclick handler passes deviceName"
      pattern: "openPreview\\([^)]+,[^)]+,[^)]+,[^)]+\\)"
    - from: "openPreview JS"
      to: "modal-device-name element"
      via: "textContent assignment"
      pattern: "modal-device-name.*textContent"
---

<objective>
Update the HTML report's preview button and modal to be more discoverable and usable.

Purpose: The current preview button is hidden until hover (mobile users never see it) and the modal lacks device context. This plan makes the preview feature prominent and informative.

Output: Updated reporter.ts with always-visible bold preview button and centered modal with device info header.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-preview-ux-polish/24-RESEARCH.md
@src/output/reporter.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update preview button CSS for prominence</name>
  <files>src/output/reporter.ts</files>
  <action>
Update the CSS_STYLES constant in reporter.ts to make the preview button always visible and prominent.

Replace the existing .preview-btn and .thumbnail-card:hover .preview-btn rules (lines 363-391) with:

```css
.preview-btn {
  position: absolute;
  top: 0.75rem;
  right: 0.75rem;
  background: #0066cc;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  z-index: 5;
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
  transition: background 0.2s ease, transform 0.15s ease, box-shadow 0.2s ease;
}

.preview-btn:hover {
  background: #0052a3;
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.preview-btn:active {
  transform: translateY(0);
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

.preview-btn:focus-visible {
  outline: 2px solid white;
  outline-offset: 2px;
}
```

Key changes:
- REMOVE opacity: 0 (button always visible now)
- REMOVE .thumbnail-card:hover .preview-btn rule entirely
- INCREASE padding from 0.25rem 0.5rem to 0.5rem 1rem
- INCREASE font-size from 0.75rem to 0.875rem
- ADD font-weight: 600 for boldness
- ADD box-shadow for prominence
- ADD :active state for tactile feedback
- INCREASE border-radius from 4px to 6px
  </action>
  <verify>
Run grep to confirm opacity: 0 is removed from .preview-btn and the hover-reveal rule is gone:
```bash
grep -n "opacity: 0" src/output/reporter.ts
grep -n "thumbnail-card:hover .preview-btn" src/output/reporter.ts
```
Both should return no results.
  </verify>
  <done>Preview button CSS has no opacity: 0, padding is 0.5rem 1rem, font-size is 0.875rem, font-weight is 600</done>
</task>

<task type="auto">
  <name>Task 2: Update modal CSS for centering and sizing</name>
  <files>src/output/reporter.ts</files>
  <action>
Update the .preview-modal and related modal CSS in CSS_STYLES (lines 236-336) with proper centering and sizing.

Replace the existing .preview-modal styles with:

```css
.preview-modal {
  width: 85vw;
  height: 85vh;
  max-width: calc(100vw - 2rem);
  max-height: calc(100vh - 2rem);
  position: fixed;
  inset: 0;
  margin: auto;
  border: none;
  border-radius: 12px;
  padding: 0;
  background: white;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.preview-modal::backdrop {
  background: rgba(0, 0, 0, 0.85);
}
```

Update .modal-header to support device title:

```css
.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 1.5rem;
  border-bottom: 1px solid #eee;
  flex-shrink: 0;
  background: white;
}

.modal-title {
  display: flex;
  flex-direction: column;
  gap: 0.125rem;
}

.modal-device-name {
  font-weight: 600;
  font-size: 1.125rem;
  color: #333;
}

.modal-device-dims {
  font-size: 0.875rem;
  color: #666;
  font-family: ui-monospace, monospace;
}
```

Update .modal-body for flexbox centering:

```css
.modal-body {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
  overflow: hidden;
  background: #f0f0f0;
}
```

Update .preview-iframe styling:

```css
.preview-iframe {
  display: block;
  border: 1px solid #ccc;
  border-radius: 8px;
  background: white;
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}
```

Key changes:
- ADD position: fixed, inset: 0, margin: auto for centering
- CHANGE max-width/max-height from 95vw/95vh to 85vw/85vh with calc fallbacks
- ADD display: flex, flex-direction: column for internal layout
- UPDATE border-radius from 8px to 12px
- ADD flex-shrink: 0 to .modal-header
- ADD flexbox centering to .modal-body
- ADD background: #f0f0f0 to .modal-body for contrast
- ADD new .modal-title, .modal-device-name, .modal-device-dims classes
  </action>
  <verify>
```bash
grep -n "position: fixed" src/output/reporter.ts
grep -n "inset: 0" src/output/reporter.ts
grep -n "modal-device-name" src/output/reporter.ts
```
All three should return results in the CSS_STYLES section.
  </verify>
  <done>Modal has position: fixed, inset: 0, margin: auto, width/height 85vw/85vh, and device name classes</done>
</task>

<task type="auto">
  <name>Task 3: Update modal HTML template and JS for device info</name>
  <files>src/output/reporter.ts</files>
  <action>
Update the generateModalTemplate function (starts around line 400) to include device info in the header and pass deviceName to openPreview.

1. Update the modal HTML template header section:
Replace the current modal-header div with:

```html
<div class="modal-header">
  <div class="modal-title">
    <span id="modal-device-name" class="modal-device-name">Device</span>
    <span id="modal-device-dims" class="modal-device-dims">0 x 0</span>
  </div>
  <button id="close-modal" class="close-btn" autofocus aria-label="Close preview">
    <span aria-hidden="true">&times;</span>
  </button>
</div>
```

2. Update the openPreview function signature in the script section:
Change from:
```javascript
function openPreview(url, width, height) {
```
To:
```javascript
function openPreview(url, width, height, deviceName) {
```

3. Add device info updates at the start of openPreview function (after previouslyFocusedElement line):
```javascript
document.getElementById('modal-device-name').textContent = deviceName;
document.getElementById('modal-device-dims').textContent = width + ' x ' + height;
```

4. Update iframe dimension constraints to work with the larger modal:
Change:
```javascript
iframe.style.width = Math.min(width, window.innerWidth * 0.9) + 'px';
iframe.style.height = Math.min(height, window.innerHeight * 0.8) + 'px';
```
To:
```javascript
iframe.style.width = Math.min(width, window.innerWidth * 0.75) + 'px';
iframe.style.height = Math.min(height, window.innerHeight * 0.65) + 'px';
```
(Reduced from 0.9/0.8 to 0.75/0.65 to fit within 85% modal with padding)

5. Update renderThumbnailCard to pass deviceName to openPreview:
Find the onclick handler and change:
```javascript
onclick="openPreview('${escapedUrl}', ${screenshot.width}, ${screenshot.height})"
```
To:
```javascript
onclick="openPreview('${escapedUrl}', ${screenshot.width}, ${screenshot.height}, '${escapedDeviceName}')"
```

Note: The escapedDeviceName variable already exists in renderThumbnailCard (line 564).
  </action>
  <verify>
```bash
# Verify openPreview has 4 parameters
grep -n "function openPreview" src/output/reporter.ts

# Verify modal template has device name elements
grep -n "modal-device-name" src/output/reporter.ts

# Verify onclick passes deviceName
grep -n "openPreview(" src/output/reporter.ts
```
  </verify>
  <done>openPreview takes 4 params (url, width, height, deviceName), modal header shows device name and dimensions, onclick handler passes deviceName</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Build and type check:
```bash
cd /home/memehalis/responsiveness-mcp && npm run build
```

2. Run tests to ensure no regressions:
```bash
npm test
```

3. Visual verification - generate a test report:
```bash
npx screenie https://example.com --phones-only
```
Then open the generated report.html and verify:
- Preview buttons are visible on all cards without hovering
- Buttons have larger, bolder appearance
- Clicking Preview opens modal centered on screen
- Modal takes ~85% of viewport
- Modal header shows device name and dimensions
- Iframe is centered within modal body
</verification>

<success_criteria>
- npm run build passes with no type errors
- npm test passes with no failures
- Preview button visible on all cards without hover
- Preview button has larger padding (0.5rem 1rem) and bold text
- Modal is centered (no left-drift)
- Modal takes 85% of viewport
- Modal header displays device name and "width x height"
- Iframe centered within modal body
- All 7 requirements (MODAL-01 through MODAL-04, BTN-01 through BTN-03) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/24-preview-ux-polish/24-01-SUMMARY.md`
</output>
